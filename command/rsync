rsync 实现数据同步

#####
服务器192.168.1.102
服务器配置文件:/etc/rsyncd.conf
chmod 600 /etc/rsyncd.conf
#指定使用rsync的用户
uid = root
#制定使用rsync的用户组
gid = root
#最大连接数0为不限制
max connections = 0
#设置超时时间
timeout = 600
#是否使用chroot
use chroot = no
#是否为只读权限
read only = no
#设置使用的端口，873为默认
port = 873
#log文件位置
#log file=/data/log/rsyncd.log
#pid文件位置
pid file=/var/run/rsyncd.pid
#lock文件位置
lock file=/var/run/rsyncd.lock
#要同步的模块名称，客户端连接时需要
[data]
#指定要同步的具体文件夹，此处为实际同步的文件夹
path=/data/ 
#备注信息,主要是一些说明信息，用来帮助记忆等  
comment=daka_back
#忽略一些无关的错误信息防止因为资源不足或其他的通信出错导致严重问题
ignore errors
#允许同步的客户机IP,多个用","隔开
hosts allow=192.168.1.104
#验证用户,为服务器的系统用户
auth users=system1
#权限必须为600
secrets file=/etc/rsyncd.passwd
#rsyncd.passwd服务端格式用户名：密码；客户端格式：密码

服务端密码文件/etc/rsyncd.passwd
内容为: system1:system1
chmod 600 /etc/rsyncd.passwd


######
客户端192.168.1.104
客户端不需要配置/etc/rsyncd.conf
只需要/etc/rsyncd.passwd就可以了
里面为system1(密码)


服务端 rsync --daemon config=/etc/rsyncd.conf或rsync --daemon


1)将dirA的所有文件同步到dirB内，并保留文件的属主，属组，文件权限等信息。
rsync -avz dirA/ dirB/

2)将dirA的所有文件同步到dirB内，并删除dirB内多余的文件
rsync -avz --delete dirA/ dirB/ #源目录和目标目录结构一定要一致！！不能是dirA/* dirB/  或者dirA/ dirB/*  或者 dirA/* dirB/*


3)将dirA的所有文件同步到dirB，但是在dirB内除了fileB3.txt这个文件
不删之外，其他的都删除。
rsync -avz --delete --exclude "fileB3.txt" dirA/ dirB/

4) 将dirA目录内的fileA1.txt和fileA2.txt不同步到dirB目录内，
并且在dirB目录内删除多余的文件。
rsync -avz --exclude="fileA1.txt" --exclude="fileA2.txt" --delete dirA/ dirB/

5）将dirA目录内的fileA1.txt和fileA2.txt不同步到dirB目录内。
rsync -avz --exclude="fileA1.txt" --exclude="fileA2.txt" dirA/ dirB/


6)将dirA目录内的fileA1.txt和fileA2.txt不同步到dirB目录内，并且在dirB目录内
删除多余的文件，同时，如果dirB内有fileA2.txt和fileA1.txt这两个被排除同步的
文件，仍然将其删除。
rsync -avz --exclude="fileA1.txt" --exclude="fileA2.txt" --delete-excluded 
dirA/ dirB/


